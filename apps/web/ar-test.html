<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Helper - Test Suite</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .test-passed {
            background: #e8f5e8;
            border-color: #c3e6c3;
        }
        
        .test-failed {
            background: #ffe6e6;
            border-color: #ffb3b3;
        }
        
        .test-pending {
            background: #fff3cd;
            border-color: #ffeaa7;
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .test-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 12px;
            text-transform: uppercase;
        }
        
        .status-pass { background: #28a745; color: white; }
        .status-fail { background: #dc3545; color: white; }
        .status-pending { background: #ffc107; color: #333; }
        
        .test-button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s;
        }
        
        .btn-test { background: #007bff; color: white; }
        .btn-test:hover { background: #0056b3; }
        
        .btn-reset { background: #6c757d; color: white; }
        .btn-reset:hover { background: #545b62; }
        
        .test-results {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #007bff;
            font-family: monospace;
            font-size: 14px;
        }
        
        .camera-preview {
            width: 100%;
            max-width: 400px;
            height: 200px;
            background: #000;
            border-radius: 8px;
            margin: 15px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
        }
        
        .nav-links {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        
        .nav-links a {
            display: inline-block;
            padding: 10px 20px;
            margin: 0 10px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            transition: background 0.3s;
        }
        
        .nav-links a:hover {
            background: #0056b3;
        }
        
        .nav-links a.secondary {
            background: #6c757d;
        }
        
        .nav-links a.secondary:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ AR Helper Test Suite</h1>
        
        <div id="overall-progress">
            <h3>Overall Test Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <p id="progress-text">0 of 6 tests completed</p>
        </div>
        
        <div class="test-section test-pending" id="test-camera">
            <div class="test-header">
                <h3>üì∑ Camera Access Test</h3>
                <span class="test-status status-pending">Pending</span>
            </div>
            <p>Test if the browser can access the device camera for AR functionality.</p>
            <button class="test-button btn-test" onclick="testCamera()">Test Camera Access</button>
            <button class="test-button btn-reset" onclick="resetTest('camera')">Reset</button>
            <div class="camera-preview" id="camera-preview">
                <span>Camera preview will appear here</span>
            </div>
            <div class="test-results" id="camera-results" style="display: none;"></div>
        </div>
        
        <div class="test-section test-pending" id="test-permissions">
            <div class="test-header">
                <h3>üîê Permissions Test</h3>
                <span class="test-status status-pending">Pending</span>
            </div>
            <p>Check camera permissions and request access if needed.</p>
            <button class="test-button btn-test" onclick="testPermissions()">Test Permissions</button>
            <button class="test-button btn-reset" onclick="resetTest('permissions')">Reset</button>
            <div class="test-results" id="permissions-results" style="display: none;"></div>
        </div>
        
        <div class="test-section test-pending" id="test-measurement">
            <div class="test-header">
                <h3>üìè Measurement Algorithm Test</h3>
                <span class="test-status status-pending">Pending</span>
            </div>
            <p>Test the distance calculation algorithm with known coordinates.</p>
            <button class="test-button btn-test" onclick="testMeasurement()">Test Measurement</button>
            <button class="test-button btn-reset" onclick="resetTest('measurement')">Reset</button>
            <div class="test-results" id="measurement-results" style="display: none;"></div>
        </div>
        
        <div class="test-section test-pending" id="test-ui">
            <div class="test-header">
                <h3>üé® UI Components Test</h3>
                <span class="test-status status-pending">Pending</span>
            </div>
            <p>Test React UI components rendering and interaction.</p>
            <button class="test-button btn-test" onclick="testUI()">Test UI Components</button>
            <button class="test-button btn-reset" onclick="resetTest('ui')">Reset</button>
            <div class="test-results" id="ui-results" style="display: none;"></div>
        </div>
        
        <div class="test-section test-pending" id="test-3d">
            <div class="test-header">
                <h3>üåê 3D Calculations Test</h3>
                <span class="test-status status-pending">Pending</span>
            </div>
            <p>Test 3D coordinate transformations and distance calculations.</p>
            <button class="test-button btn-test" onclick="test3D()">Test 3D Calculations</button>
            <button class="test-button btn-reset" onclick="resetTest('3d')">Reset</button>
            <div class="test-results" id="3d-results" style="display: none;"></div>
        </div>
        
        <div class="test-section test-pending" id="test-integration">
            <div class="test-header">
                <h3>üîó Integration Test</h3>
                <span class="test-status status-pending">Pending</span>
            </div>
            <p>Test full AR Helper workflow end-to-end.</p>
            <button class="test-button btn-test" onclick="testIntegration()">Test Integration</button>
            <button class="test-button btn-reset" onclick="resetTest('integration')">Reset</button>
            <div class="test-results" id="integration-results" style="display: none;"></div>
        </div>
        
        <div class="nav-links">
            <a href="../">Launch AR Helper</a>
            <a href="/ar-demo.html" class="secondary">View Demo</a>
            <a href="/stats.html" class="secondary">Statistics</a>
        </div>
    </div>

    <script>
        let completedTests = 0;
        const totalTests = 6;
        
        function updateProgress() {
            const progressPercent = (completedTests / totalTests) * 100;
            document.getElementById('progress-fill').style.width = progressPercent + '%';
            document.getElementById('progress-text').textContent = `${completedTests} of ${totalTests} tests completed`;
        }
        
        function setTestResult(testId, passed, message) {
            const testSection = document.getElementById(`test-${testId}`);
            const statusElement = testSection.querySelector('.test-status');
            const resultsElement = document.getElementById(`${testId}-results`);
            
            testSection.className = `test-section ${passed ? 'test-passed' : 'test-failed'}`;
            statusElement.className = `test-status ${passed ? 'status-pass' : 'status-fail'}`;
            statusElement.textContent = passed ? 'Passed' : 'Failed';
            
            resultsElement.style.display = 'block';
            resultsElement.innerHTML = message;
            
            if (!testSection.dataset.completed) {
                testSection.dataset.completed = 'true';
                completedTests++;
                updateProgress();
            }
        }
        
        function resetTest(testId) {
            const testSection = document.getElementById(`test-${testId}`);
            const statusElement = testSection.querySelector('.test-status');
            const resultsElement = document.getElementById(`${testId}-results`);
            
            testSection.className = 'test-section test-pending';
            statusElement.className = 'test-status status-pending';
            statusElement.textContent = 'Pending';
            resultsElement.style.display = 'none';
            
            if (testSection.dataset.completed) {
                testSection.dataset.completed = '';
                completedTests--;
                updateProgress();
            }
        }
        
        async function testCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                
                const preview = document.getElementById('camera-preview');
                const video = document.createElement('video');
                video.srcObject = stream;
                video.autoplay = true;
                video.playsInline = true;
                video.style.width = '100%';
                video.style.height = '100%';
                video.style.objectFit = 'cover';
                
                preview.innerHTML = '';
                preview.appendChild(video);
                
                setTestResult('camera', true, 'Camera access successful! Video stream is active.');
                
                // Stop stream after 5 seconds for testing
                setTimeout(() => {
                    stream.getTracks().forEach(track => track.stop());
                }, 5000);
                
            } catch (error) {
                setTestResult('camera', false, `Camera access failed: ${error.message}`);
            }
        }
        
        async function testPermissions() {
            try {
                const permissions = await navigator.permissions.query({ name: 'camera' });
                const state = permissions.state;
                
                let message = `Camera permission state: ${state}`;
                if (state === 'granted') {
                    message += '\n‚úÖ Camera access is granted';
                } else if (state === 'prompt') {
                    message += '\n‚ö†Ô∏è Permission will be requested when needed';
                } else {
                    message += '\n‚ùå Camera access is denied';
                }
                
                setTestResult('permissions', state !== 'denied', message);
                
            } catch (error) {
                setTestResult('permissions', false, `Permission check failed: ${error.message}`);
            }
        }
        
        function testMeasurement() {
            try {
                // Test distance calculation algorithm
                const point1 = { x: 0, y: 0, z: 0 };
                const point2 = { x: 3, y: 4, z: 0 };
                
                const distance = Math.sqrt(
                    Math.pow(point2.x - point1.x, 2) + 
                    Math.pow(point2.y - point1.y, 2) + 
                    Math.pow(point2.z - point1.z, 2)
                );
                
                const expectedDistance = 5; // 3-4-5 triangle
                const isAccurate = Math.abs(distance - expectedDistance) < 0.001;
                
                let message = `Calculated distance: ${distance.toFixed(3)} units\n`;
                message += `Expected distance: ${expectedDistance} units\n`;
                message += `Accuracy: ${isAccurate ? 'Perfect' : 'Inaccurate'}`;
                
                setTestResult('measurement', isAccurate, message);
                
            } catch (error) {
                setTestResult('measurement', false, `Measurement test failed: ${error.message}`);
            }
        }
        
        function testUI() {
            try {
                // Test if React components would render properly
                const hasReact = typeof React !== 'undefined';
                const hasReactDOM = typeof ReactDOM !== 'undefined';
                
                let message = 'UI Component Test Results:\n';
                message += `React available: ${hasReact ? 'Yes' : 'No'}\n`;
                message += `ReactDOM available: ${hasReactDOM ? 'Yes' : 'No'}\n`;
                message += `DOM manipulation: Working\n`;
                message += `Event handling: Working`;
                
                // Simple DOM test
                const testDiv = document.createElement('div');
                testDiv.textContent = 'Test component';
                const canManipulateDOM = testDiv.textContent === 'Test component';
                
                setTestResult('ui', canManipulateDOM, message);
                
            } catch (error) {
                setTestResult('ui', false, `UI test failed: ${error.message}`);
            }
        }
        
        function test3D() {
            try {
                // Test 3D coordinate transformations
                const transformations = [
                    { input: [0, 0, 0], expected: [0, 0, 0] },
                    { input: [1, 1, 1], expected: [1, 1, 1] },
                    { input: [-1, 2, -3], expected: [-1, 2, -3] }
                ];
                
                let allTestsPassed = true;
                let message = '3D Transformation Tests:\n';
                
                transformations.forEach((test, index) => {
                    const [x, y, z] = test.input;
                    const [ex, ey, ez] = test.expected;
                    
                    // Simple identity transformation test
                    const transformed = [x, y, z];
                    const passed = transformed[0] === ex && transformed[1] === ey && transformed[2] === ez;
                    
                    message += `Test ${index + 1}: ${passed ? '‚úÖ' : '‚ùå'} [${x},${y},${z}] ‚Üí [${transformed[0]},${transformed[1]},${transformed[2]}]\n`;
                    if (!passed) allTestsPassed = false;
                });
                
                setTestResult('3d', allTestsPassed, message);
                
            } catch (error) {
                setTestResult('3d', false, `3D test failed: ${error.message}`);
            }
        }
        
        function testIntegration() {
            try {
                // Test integration of all components
                const tests = {
                    camera: document.getElementById('test-camera').dataset.completed,
                    permissions: document.getElementById('test-permissions').dataset.completed,
                    measurement: document.getElementById('test-measurement').dataset.completed,
                    ui: document.getElementById('test-ui').dataset.completed,
                    threeDee: document.getElementById('test-3d').dataset.completed
                };
                
                const passedTests = Object.values(tests).filter(test => test === 'true').length;
                const totalComponentTests = 5;
                
                let message = 'Integration Test Results:\n';
                message += `Completed component tests: ${passedTests}/${totalComponentTests}\n`;
                message += `Camera: ${tests.camera === 'true' ? '‚úÖ' : '‚ùå'}\n`;
                message += `Permissions: ${tests.permissions === 'true' ? '‚úÖ' : '‚ùå'}\n`;
                message += `Measurement: ${tests.measurement === 'true' ? '‚úÖ' : '‚ùå'}\n`;
                message += `UI: ${tests.ui === 'true' ? '‚úÖ' : '‚ùå'}\n`;
                message += `3D Calculations: ${tests.threeDee === 'true' ? '‚úÖ' : '‚ùå'}\n`;
                
                const integrationPassed = passedTests >= 4; // Allow one test to fail
                message += `\nIntegration Status: ${integrationPassed ? 'PASSED' : 'FAILED'}`;
                
                setTestResult('integration', integrationPassed, message);
                
            } catch (error) {
                setTestResult('integration', false, `Integration test failed: ${error.message}`);
            }
        }
        
        // Initialize progress
        updateProgress();
    </script>
</body>
</html>