<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Simple 3D Measurement Tool">
    
    <title>3D Measurement Tool</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="src/styles.css">
</head>
<body>
    <!-- Main App Container -->
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <h1>3D Measurement Tool</h1>
            <p class="subtitle">Click two points in 3D space to measure distance</p>
        </header>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- 3D View Container -->
            <div id="measurement-container" class="measurement-container">
                <div class="measurement-placeholder">
                    <div class="placeholder-content">
                        <div class="placeholder-icon">üìè</div>
                        <h2>3D Measurement View</h2>
                        <p>Click "Start" to begin measuring</p>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls">
                <button id="start-session" class="btn btn-primary">
                    <span class="btn-icon">‚ñ∂</span>
                    <span class="btn-text">Start</span>
                </button>
                <button id="clear-measurement" class="btn btn-secondary" disabled>
                    <span class="btn-icon">üßπ</span>
                    <span class="btn-text">Clear</span>
                </button>
                <button id="reset-session" class="btn btn-tertiary">
                    <span class="btn-icon">‚Üª</span>
                    <span class="btn-text">Reset</span>
                </button>
            </div>

            <!-- Distance Display -->
            <div id="distance-display" class="distance-display">
                <div class="distance-label">Distance:</div>
                <div id="distance-value" class="distance-value">-</div>
            </div>

            <!-- Instructions -->
            <div class="instructions">
                <p id="instruction-text">Click "Start" to begin measuring distance between two points</p>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div id="loading" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p id="loading-message">Initializing 3D scene...</p>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="error-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Error</h3>
            <p id="error-message">An error occurred</p>
            <button id="error-close" class="btn btn-primary">OK</button>
        </div>
    </div>

    <!-- Three.js Library with fallback -->
    <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
    <script>
        // Fallback: Create a simple mock THREE object if CDN fails
        if (!window.THREE) {
            console.log('THREE.js CDN failed, creating mock object for demo');
            window.THREE = {
                Scene: function() { 
                    this.add = function() {}; 
                    this.remove = function() {};
                    this.traverse = function() {};
                    this.background = null;
                },
                PerspectiveCamera: function() { 
                    this.position = { set: function() {}, x: 0, y: 0, z: 0 };
                    this.aspect = 1;
                    this.updateProjectionMatrix = function() {};
                },
                WebGLRenderer: function() { 
                    this.domElement = document.createElement('canvas');
                    this.domElement.style.width = '100%';
                    this.domElement.style.height = '100%';
                    this.domElement.style.background = '#333';
                    this.setPixelRatio = function() {};
                    this.setSize = function() {};
                    this.dispose = function() {};
                    this.render = function() {};
                    this.shadowMap = { enabled: false, type: null };
                },
                Color: function(color) { return color; },
                AmbientLight: function() { this.position = { set: function() {} }; },
                DirectionalLight: function() { 
                    this.position = { set: function() {} };
                    this.castShadow = false;
                    this.shadow = { mapSize: { width: 0, height: 0 } };
                },
                GridHelper: function() {},
                PlaneGeometry: function() { this.dispose = function() {}; },
                SphereGeometry: function() { this.dispose = function() {}; },
                BufferGeometry: function() { 
                    this.setFromPoints = function() { return this; };
                    this.setAttribute = function() {};
                    this.dispose = function() {};
                },
                MeshBasicMaterial: function() { 
                    this.dispose = function() {};
                    this.opacity = 1;
                },
                LineBasicMaterial: function() { 
                    this.dispose = function() {};
                    this.opacity = 1;
                },
                Mesh: function() { 
                    this.position = { copy: function() {}, set: function() {}, x: 0, y: 0, z: 0 };
                    this.scale = { set: function() {}, multiplyScalar: function() {}, x: 1, y: 1, z: 1 };
                    this.rotation = { x: 0, y: 0, z: 0 };
                },
                Line: function() { 
                    this.position = { copy: function() {}, set: function() {}, x: 0, y: 0, z: 0 };
                },
                Vector2: function() { this.x = 0; this.y = 0; },
                Vector3: function(x, y, z) { 
                    this.x = x || 0; 
                    this.y = y || 0; 
                    this.z = z || 0;
                    this.clone = function() { return new window.THREE.Vector3(this.x, this.y, this.z); };
                    this.copy = function(v) { this.x = v.x; this.y = v.y; this.z = v.z; return this; };
                    this.distanceTo = function(v) { 
                        return Math.sqrt(Math.pow(v.x - this.x, 2) + Math.pow(v.y - this.y, 2) + Math.pow(v.z - this.z, 2)); 
                    };
                    this.addVectors = function(a, b) { this.x = a.x + b.x; this.y = a.y + b.y; this.z = a.z + b.z; return this; };
                    this.multiplyScalar = function(s) { this.x *= s; this.y *= s; this.z *= s; return this; };
                },
                Raycaster: function() { 
                    this.setFromCamera = function() {};
                    this.intersectObject = function() { 
                        // Return a mock intersection for demo
                        return [{ point: new window.THREE.Vector3(Math.random() * 4 - 2, 0, Math.random() * 4 - 2) }];
                    };
                },
                BufferAttribute: function() {},
                PCFSoftShadowMap: 'PCFSoftShadowMap'
            };
            console.log('Mock THREE.js object created for demo purposes');
        }
    </script>
    
    <!-- Main Application -->
    <script type="module" src="src/app.js"></script>
</body>
</html>